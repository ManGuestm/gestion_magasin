# Diagramme Architecture Serveur/Client

## ğŸ—ï¸ Architecture globale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RÃ‰SEAU LOCAL (LAN)                          â”‚
â”‚                         192.168.1.0/24                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
        â”‚                         â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SERVEUR      â”‚       â”‚   CLIENT 1      â”‚       â”‚   CLIENT 2     â”‚
â”‚                â”‚       â”‚                 â”‚       â”‚                â”‚
â”‚ ğŸ–¥ï¸  Principal  â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ ğŸ’» Vendeur      â”‚       â”‚ ğŸ’» Caisse      â”‚
â”‚                â”‚  WS   â”‚                 â”‚       â”‚                â”‚
â”‚ 192.168.1.100  â”‚       â”‚ 192.168.1.101   â”‚       â”‚ 192.168.1.102  â”‚
â”‚ Port: 8080     â”‚       â”‚                 â”‚       â”‚                â”‚
â”‚                â”‚       â”‚                 â”‚       â”‚                â”‚
â”‚ ğŸ”’ Admin       â”‚       â”‚ ğŸ”’ Vendeur      â”‚       â”‚ ğŸ”’ Caisse      â”‚
â”‚                â”‚       â”‚                 â”‚       â”‚                â”‚
â”‚ ğŸ’¾ SQLite      â”‚       â”‚ âŒ Pas de DB    â”‚       â”‚ âŒ Pas de DB   â”‚
â”‚ Locale         â”‚       â”‚                 â”‚       â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flux de synchronisation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT A    â”‚
â”‚  (Vendeur)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. POST /api/query
       â”‚    INSERT INTO ventes...
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SERVEUR    â”‚
â”‚   (Admin)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Enregistrement SQLite
       â”‚
       â”‚ 3. Broadcast WebSocket
       â”‚    {"type": "data_change", ...}
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚                 â”‚
       â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT A    â”‚  â”‚  CLIENT B    â”‚  â”‚  CLIENT C    â”‚
â”‚  (Vendeur)   â”‚  â”‚  (Caisse)    â”‚  â”‚  (Vendeur)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â”‚ 4. Notification â”‚                 â”‚
       â”‚    RafraÃ®chir   â”‚                 â”‚
       â–¼                 â–¼                 â–¼
   [UI Update]      [UI Update]      [UI Update]
```

## ğŸ” ContrÃ´le d'accÃ¨s

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTIFICATION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VÃ©rifier rÃ´le â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
            â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Administrateurâ”‚ â”‚    Caisse    â”‚ â”‚   Vendeur    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚                â”‚
           â”‚                â”‚                â”‚
    Mode CLIENT?     Mode CLIENT?     Mode CLIENT?
           â”‚                â”‚                â”‚
           â–¼                â–¼                â–¼
        âŒ NON           âœ… OUI           âœ… OUI
           â”‚                â”‚                â”‚
           â–¼                â–¼                â–¼
    AccÃ¨s refusÃ©     Token gÃ©nÃ©rÃ©     Token gÃ©nÃ©rÃ©
                           â”‚                â”‚
                           â–¼                â–¼
                    Connexion OK     Connexion OK
```

## ğŸ“Š Flux de donnÃ©es

```
MODE SERVEUR (Administrateur)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Application â”€â”€â–º DatabaseService â”€â”€â–º SQLite Local      â”‚
â”‚       â”‚                                    â”‚            â”‚
â”‚       â”‚                                    â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â–º NetworkServer â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                       â”‚                                 â”‚
â”‚                       â”‚ Broadcast                       â”‚
â”‚                       â–¼                                 â”‚
â”‚                  WebSocket â”€â”€â–º Tous les clients         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


MODE CLIENT (Caisse/Vendeur)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  Application â”€â”€â–º NetworkClient â”€â”€â–º HTTP/WebSocket      â”‚
â”‚                       â”‚                  â”‚              â”‚
â”‚                       â”‚                  â”‚              â”‚
â”‚                       â–¼                  â–¼              â”‚
â”‚                  Serveur â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ Serveur            â”‚
â”‚                  (RequÃªtes)        (Notifications)      â”‚
â”‚                                                         â”‚
â”‚  âŒ Pas de SQLite local                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ SÃ©curitÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COUCHES DE SÃ‰CURITÃ‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Authentification
   â”œâ”€ Username + Password
   â”œâ”€ VÃ©rification bcrypt
   â””â”€ Token gÃ©nÃ©rÃ©

2. Validation du rÃ´le
   â”œâ”€ Administrateur â†’ Serveur uniquement
   â”œâ”€ Caisse â†’ Client uniquement
   â””â”€ Vendeur â†’ Client uniquement

3. WebSocket sÃ©curisÃ©
   â”œâ”€ Bearer Token requis
   â”œâ”€ Validation CSRF (Origin/Host)
   â””â”€ Session Manager

4. Audit complet
   â”œâ”€ Toutes les tentatives loggÃ©es
   â”œâ”€ Actions tracÃ©es
   â””â”€ Historique complet
```

## ğŸ“¡ API Endpoints

```
SERVEUR (Port 8080)

GET  /api/health
     â†’ Status du serveur

POST /api/auth
     Body: {"username": "...", "password": "..."}
     â†’ Authentification + Token

POST /api/query
     Headers: Authorization: Bearer <token>
     Body: {"type": "select|insert|update|delete", "query": "...", "params": [...]}
     â†’ ExÃ©cution requÃªte SQL

WS   /ws
     Headers: Authorization: Bearer <token>
     â†’ WebSocket pour synchronisation temps rÃ©el

GET  /api/metrics
     â†’ Statistiques serveur (clients connectÃ©s, etc.)
```

## ğŸ”„ Cycle de vie

```
DÃ‰MARRAGE SERVEUR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Initialiser SQLite local                            â”‚
â”‚ 2. DÃ©marrer HTTP Server (port 8080)                    â”‚
â”‚ 3. DÃ©marrer WebSocket Server                           â”‚
â”‚ 4. Activer services de sÃ©curitÃ©                        â”‚
â”‚ 5. PrÃªt Ã  accepter connexions                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DÃ‰MARRAGE CLIENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Charger configuration (IP serveur, port)            â”‚
â”‚ 2. Tester connexion HTTP                               â”‚
â”‚ 3. Authentifier (username, password)                   â”‚
â”‚ 4. Recevoir token                                      â”‚
â”‚ 5. Connecter WebSocket avec token                      â”‚
â”‚ 6. PrÃªt Ã  envoyer/recevoir donnÃ©es                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Performance

```
LATENCE RÃ‰SEAU (LAN typique)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ping:                    < 1 ms                         â”‚
â”‚ RequÃªte HTTP:            5-10 ms                        â”‚
â”‚ WebSocket notification:  < 5 ms                         â”‚
â”‚ Synchronisation totale:  10-20 ms                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAPACITÃ‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clients simultanÃ©s:      50+ (testÃ©)                    â”‚
â”‚ RequÃªtes/minute:         1000+ (avec rate limiting)     â”‚
â”‚ Taille base SQLite:      IllimitÃ©e (pratique: < 10 GB)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**LÃ©gende**:
- ğŸ–¥ï¸ = Serveur
- ğŸ’» = Client
- ğŸ”’ = Restriction d'accÃ¨s
- ğŸ’¾ = Base de donnÃ©es
- âŒ = Interdit
- âœ… = AutorisÃ©
- â—„â”€â–º = Communication bidirectionnelle
- â”€â”€â–º = Communication unidirectionnelle
